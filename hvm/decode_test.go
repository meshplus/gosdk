package hvm

import (
	"github.com/stretchr/testify/assert"
	"testing"
)

func TestDecodePayload(t *testing.T) {
	result, err := DecodePayload("000005460012cafebabe0000003400370a000a00260900090027090009002809000900290b0007002a0a002b002c07002d0a0009002e07002f070030070031010006667269656e640100124c6a6176612f6c616e672f537472696e673b01000576616c756501000149010005664c6973740100154c6a6176612f7574696c2f41727261794c6973743b0100095369676e61747572650100294c6a6176612f7574696c2f41727261794c6973743c4c6a6176612f6c616e672f537472696e673b3e3b0100063c696e69743e010003282956010004436f646501000f4c696e654e756d6265725461626c650100124c6f63616c5661726961626c655461626c65010004746869730100144c696e766f6b652f5368617265496e766f6b653b01002b284c6a6176612f6c616e672f537472696e673b494c6a6176612f7574696c2f41727261794c6973743b29560100164c6f63616c5661726961626c65547970655461626c6501003f284c6a6176612f6c616e672f537472696e673b494c6a6176612f7574696c2f41727261794c6973743c4c6a6176612f6c616e672f537472696e673b3e3b2956010006696e766f6b65010023284c6c6f6769632f4953686172653b294c6a6176612f6c616e672f426f6f6c65616e3b0100036f626a01000e4c6c6f6769632f4953686172653b010042284c636e2f6879706572636861696e2f636f6e74726163742f42617365436f6e7472616374496e746572666163653b294c6a6176612f6c616e672f4f626a6563743b0100584c6a6176612f6c616e672f4f626a6563743b4c636e2f6879706572636861696e2f636f6e74726163742f42617365496e766f6b653c4c6a6176612f6c616e672f426f6f6c65616e3b4c6c6f6769632f4953686172653b3e3b01000a536f7572636546696c650100105368617265496e766f6b652e6a6176610c001400150c000c000d0c000e000f0c001000110c003200330700340c0035003601000c6c6f6769632f4953686172650c001e001f010012696e766f6b652f5368617265496e766f6b650100106a6176612f6c616e672f4f626a656374010021636e2f6879706572636861696e2f636f6e74726163742f42617365496e766f6b6501000a73686172654d6f6e657901002b284c6a6176612f6c616e672f537472696e673b494c6a6176612f7574696c2f41727261794c6973743b295a0100116a6176612f6c616e672f426f6f6c65616e01000776616c75654f66010016285a294c6a6176612f6c616e672f426f6f6c65616e3b00210009000a0001000b00030001000c000d00000001000e000f0000000100100011000100120000000200130004000100140015000100160000003300010001000000052ab70001b10000000200170000000a00020000000d0004000e00180000000c0001000000050019001a000000010014001b000200160000007e00020004000000142ab700012a2bb500022a1cb500032a2db50004b1000000030017000000160005000000100004001100090012000e00130013001400180000002a0004000000140019001a000000000014000c000d000100000014000e000f000200000014001000110003001c0000000c000100000014001000130003001200000002001d0001001e001f000100160000004a00040002000000162b2ab400022ab400032ab40004b900050400b80006b0000000020017000000060001000000170018000000160002000000160019001a0000000000160020002100011041001e0022000100160000003300020002000000092a2bc00007b60008b00000000200170000000600010000000800180000000c0001000000090019001a0000000200120000000200230024000000020025696e766f6b652e5368617265496e766f6b657b22667269656e64223a22667269656e6431222c2276616c7565223a3130302c22664c697374223a5b22667269656e6432222c22667269656e6433225d7d")
	assert.Nil(t, err)
	assert.Equal(t, "shareMoney", result.InvokeMethods[0])
}

func TestDecodePayload2(t *testing.T) {
	// direct
	result, err := DecodePayload("0xfefffbce00087472616e736665720010000000036a6176612e6c616e672e537472696e674141410010000000036a6176612e6c616e672e537472696e674242420004000000036c6f6e67313030")
	assert.Nil(t, err)
	assert.Equal(t, "transfer", result.InvokeMethods[0])
}
